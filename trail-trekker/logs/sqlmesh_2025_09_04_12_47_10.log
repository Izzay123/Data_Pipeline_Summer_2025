2025-09-04 12:47:11,124 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'../trail_trekker.db'} (connection.py:489)
2025-09-04 12:47:11,411 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: ../trail_trekker.db (connection.py:479)
2025-09-04 12:47:15,790 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-09-04 12:47:15,798 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:125)
2025-09-04 12:47:15,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'sqlmesh__default' (evaluator.py:1378)
2025-09-04 12:47:15,799 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ CREATE SCHEMA IF NOT EXISTS "sqlmesh__default" (base.py:2452)
2025-09-04 12:47:15,799 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-09-04 12:47:15,825 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema sqlmesh__default (evaluator.py:444)
2025-09-04 12:47:15,825 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT CURRENT_CATALOG() (base.py:2452)
2025-09-04 12:47:15,825 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2613690352', 'staging_plans__223612256', 'raw_subscriptions__1243030195', 'staging_customers__3937340300', 'staging_subscriptions__3522423559', 'raw_plans__3266981680', 'raw_customers__3189645474', 'raw_features__8593745', 'staging_features__2301256321', 'raw_plan_features__32802264') (base.py:2452)
2025-09-04 12:47:15,832 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"fct_subscription_changes": 4234369946> (evaluator.py:727)
2025-09-04 12:47:15,832 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ DESCRIBE "sqlmesh__default"."fct_subscription_changes__2613690352" (base.py:2452)
2025-09-04 12:47:15,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating view 'sqlmesh__default.fct_subscription_changes__2613690352' (evaluator.py:2349)
2025-09-04 12:47:15,838 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ CREATE VIEW "sqlmesh__default"."fct_subscription_changes__2613690352" AS SELECT "staging_subscriptions"."customer_id" AS "customer_id", "staging_subscriptions"."subscription_id" AS "subscription_id", "staging_subscriptions"."plan_id" AS "current_plan_id", "staging_subscriptions"."subscription_start_date" AS "subscription_start_date", "staging_subscriptions"."subscription_end_date" AS "subscription_end_date" FROM "sqlmesh__default"."staging_subscriptions__3522423559" AS "staging_subscriptions" ORDER BY "customer_id", "subscription_id", "subscription_start_date" DESC (base.py:2452)
2025-09-04 12:47:15,838 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"fct_subscription_changes": 4234369946> (evaluator.py:916)
2025-09-04 12:47:15,841 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-09-03 00:00:00, 2025-09-04 00:00:00) into sqlmesh__default.fct_subscription_changes__2613690352' (evaluator.py:947)
2025-09-04 12:47:15,841 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Replacing view 'sqlmesh__default.fct_subscription_changes__2613690352' (evaluator.py:2313)
2025-09-04 12:47:15,841 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT CURRENT_CATALOG() (base.py:2452)
2025-09-04 12:47:15,842 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2613690352') (base.py:2452)
2025-09-04 12:47:15,844 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ CREATE OR REPLACE VIEW "sqlmesh__default"."fct_subscription_changes__2613690352" ("customer_id", "subscription_id", "current_plan_id", "subscription_start_date", "subscription_end_date") AS SELECT "staging_subscriptions"."customer_id" AS "customer_id", "staging_subscriptions"."subscription_id" AS "subscription_id", "staging_subscriptions"."plan_id" AS "current_plan_id", "staging_subscriptions"."subscription_start_date" AS "subscription_start_date", "staging_subscriptions"."subscription_end_date" AS "subscription_end_date" FROM "sqlmesh__default"."staging_subscriptions__3522423559" AS "staging_subscriptions" ORDER BY "customer_id", "subscription_id", "subscription_start_date" DESC (base.py:2452)
2025-09-04 12:47:15,844 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"fct_subscription_changes": 4234369946> (evaluator.py:619)
2025-09-04 12:47:15,844 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ DESCRIBE "sqlmesh__default"."fct_subscription_changes__2613690352" (base.py:2452)
2025-09-04 12:47:15,847 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT COUNT(*) FROM (SELECT * FROM "trail_trekker"."sqlmesh__default"."fct_subscription_changes__2613690352" AS "fct_subscription_changes__2613690352" WHERE ("subscription_id" IS NULL OR "customer_id" IS NULL) AND TRUE) AS "audit" (base.py:2452)
2025-09-04 12:47:15,847 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-09-03 00:00:00, 2025-09-04 00:00:00) for snapshot SnapshotId<"fct_subscription_changes": 4234369946> (facade.py:619)
2025-09-04 12:47:15,847 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"fct_subscription_changes": 4234369946> (interval.py:214)
2025-09-04 12:47:15,853 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-09-04 12:47:15,853 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:167)
2025-09-04 12:47:15,859 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:125)
2025-09-04 12:47:15,861 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-09-04 12:47:15,862 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'default' (evaluator.py:1378)
2025-09-04 12:47:15,862 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ CREATE SCHEMA IF NOT EXISTS "default" (base.py:2452)
2025-09-04 12:47:15,863 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'default.fct_subscription_changes' to point at table 'sqlmesh__default.fct_subscription_changes__2613690352' (evaluator.py:1694)
2025-09-04 12:47:15,863 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT CURRENT_CATALOG() (base.py:2452)
2025-09-04 12:47:15,863 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'default') AND table_name IN ('fct_subscription_changes') (base.py:2452)
2025-09-04 12:47:15,865 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 34b980dc22d143c098954e3c682eead3 */ CREATE OR REPLACE VIEW "default"."fct_subscription_changes" AS SELECT * FROM "sqlmesh__default"."fct_subscription_changes__2613690352" (base.py:2452)
2025-09-04 12:47:15,866 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-09-04 12:47:15,866 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:141)
2025-09-04 12:47:15,877 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
