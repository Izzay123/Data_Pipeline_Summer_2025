2025-09-17 15:18:44,794 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'../trail_trekker.db'} (connection.py:491)
2025-09-17 15:18:45,011 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: ../trail_trekker.db (connection.py:481)
2025-09-17 15:18:45,148 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:123)
2025-09-17 15:18:45,153 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:123)
2025-09-17 15:18:45,154 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'sqlmesh__default' (evaluator.py:1374)
2025-09-17 15:18:45,154 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ CREATE SCHEMA IF NOT EXISTS "sqlmesh__default" (base.py:2498)
2025-09-17 15:18:45,154 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:123)
2025-09-17 15:18:45,155 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema sqlmesh__default (evaluator.py:1477)
2025-09-17 15:18:45,155 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT CURRENT_CATALOG() (base.py:2498)
2025-09-17 15:18:45,156 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2124406755') (base.py:2498)
2025-09-17 15:18:45,161 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"fct_subscription_changes": 1219693312> (evaluator.py:700)
2025-09-17 15:18:45,161 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"fct_subscription_changes": 1219693312> (evaluator.py:909)
2025-09-17 15:18:45,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-09-16 00:00:00, 2025-09-17 00:00:00) into sqlmesh__default.fct_subscription_changes__2124406755' (evaluator.py:939)
2025-09-17 15:18:45,167 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ DESCRIBE "sqlmesh__default"."fct_subscription_changes__2124406755" (base.py:2498)
2025-09-17 15:18:45,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Replacing view 'sqlmesh__default.fct_subscription_changes__2124406755' (evaluator.py:2341)
2025-09-17 15:18:45,167 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT CURRENT_CATALOG() (base.py:2498)
2025-09-17 15:18:45,168 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2124406755') (base.py:2498)
2025-09-17 15:18:45,170 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ CREATE OR REPLACE VIEW "sqlmesh__default"."fct_subscription_changes__2124406755" ("customer_id", "subscription_id", "plan_id", "subscription_start_date", "subscription_end_date", "status", "billing_cycle", "plan_name", "monthly_revenue", "plan_level", "max_hikes_per_month", "subscription_duration_days", "is_active", "total_subscription_value") AS SELECT "s"."customer_id" AS "customer_id", "s"."subscription_id" AS "subscription_id", "s"."plan_id" AS "plan_id", "s"."subscription_start_date" AS "subscription_start_date", "s"."subscription_end_date" AS "subscription_end_date", "s"."status" AS "status", "s"."billing_cycle" AS "billing_cycle", "p"."plan_name" AS "plan_name", "p"."price" AS "monthly_revenue", "p"."plan_level" AS "plan_level", "p"."max_hikes_per_month" AS "max_hikes_per_month", CASE WHEN "s"."subscription_end_date" = CAST('1900-01-01' AS DATE) THEN DATE_DIFF('DAY', TRY_CAST("s"."subscription_start_date" AS DATE), CURRENT_DATE) ELSE DATE_DIFF('DAY', TRY_CAST("s"."subscription_start_date" AS DATE), "s"."subscription_end_date") END AS "subscription_duration_days", CASE WHEN "s"."status" = 'active' AND "s"."subscription_end_date" = CAST('1900-01-01' AS DATE) THEN TRUE ELSE FALSE END AS "is_active", CASE WHEN "s"."billing_cycle" = 'monthly' THEN "p"."price" WHEN "s"."billing_cycle" = 'yearly' THEN "p"."price" * 12 ELSE "p"."price" END AS "total_subscription_value" FROM "sqlmesh__default"."staging_subscriptions__3522423559" AS "s" LEFT JOIN "sqlmesh__default"."staging_plans__223612256" AS "p" ON "p"."plan_id" = "s"."plan_id" ORDER BY "s"."customer_id", "s"."subscription_start_date" DESC (base.py:2498)
2025-09-17 15:18:45,171 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ COMMENT ON COLUMN "sqlmesh__default"."fct_subscription_changes__2124406755"."plan_name" IS 'Plan details' (base.py:2498)
2025-09-17 15:18:45,172 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ COMMENT ON COLUMN "sqlmesh__default"."fct_subscription_changes__2124406755"."subscription_duration_days" IS 'Calculated metrics' (base.py:2498)
2025-09-17 15:18:45,172 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ COMMENT ON COLUMN "sqlmesh__default"."fct_subscription_changes__2124406755"."total_subscription_value" IS 'Revenue calculation' (base.py:2498)
2025-09-17 15:18:45,172 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"fct_subscription_changes": 1219693312> (evaluator.py:592)
2025-09-17 15:18:45,172 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ DESCRIBE "sqlmesh__default"."fct_subscription_changes__2124406755" (base.py:2498)
2025-09-17 15:18:45,175 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT COUNT(*) FROM (SELECT * FROM "trail_trekker"."sqlmesh__default"."fct_subscription_changes__2124406755" AS "fct_subscription_changes__2124406755" WHERE ("subscription_id" IS NULL OR "customer_id" IS NULL OR "plan_id" IS NULL) AND TRUE) AS "audit" (base.py:2498)
2025-09-17 15:18:45,177 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-09-16 00:00:00, 2025-09-17 00:00:00) for snapshot SnapshotId<"fct_subscription_changes": 1219693312> (facade.py:623)
2025-09-17 15:18:45,177 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"fct_subscription_changes": 1219693312> (interval.py:214)
2025-09-17 15:18:45,181 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:123)
2025-09-17 15:18:45,182 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'dev' (facade.py:166)
2025-09-17 15:18:45,186 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:123)
2025-09-17 15:18:45,187 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'default__dev' (evaluator.py:1374)
2025-09-17 15:18:45,187 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ CREATE SCHEMA IF NOT EXISTS "default__dev" (base.py:2498)
2025-09-17 15:18:45,188 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'default__dev.fct_subscription_changes' to point at table 'sqlmesh__default.fct_subscription_changes__2124406755' (evaluator.py:1746)
2025-09-17 15:18:45,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT CURRENT_CATALOG() (base.py:2498)
2025-09-17 15:18:45,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'default__dev') AND table_name IN ('fct_subscription_changes') (base.py:2498)
2025-09-17 15:18:45,190 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e7b734321d3437fb60e796b9caab610 */ CREATE OR REPLACE VIEW "default__dev"."fct_subscription_changes" AS SELECT * FROM "sqlmesh__default"."fct_subscription_changes__2124406755" (base.py:2498)
2025-09-17 15:18:45,191 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:123)
2025-09-17 15:18:45,191 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'dev' (environment.py:141)
2025-09-17 15:18:45,205 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
