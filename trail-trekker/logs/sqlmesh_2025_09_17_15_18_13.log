2025-09-17 15:18:13,506 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'../trail_trekker.db'} (connection.py:491)
2025-09-17 15:18:13,766 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: ../trail_trekker.db (connection.py:481)
2025-09-17 15:18:13,922 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:123)
2025-09-17 15:18:13,928 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:123)
2025-09-17 15:18:13,928 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'sqlmesh__default' (evaluator.py:1374)
2025-09-17 15:18:13,928 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ CREATE SCHEMA IF NOT EXISTS "sqlmesh__default" (base.py:2498)
2025-09-17 15:18:13,928 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:123)
2025-09-17 15:18:13,929 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema sqlmesh__default (evaluator.py:1477)
2025-09-17 15:18:13,930 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ SELECT CURRENT_CATALOG() (base.py:2498)
2025-09-17 15:18:13,930 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2699429937') (base.py:2498)
2025-09-17 15:18:13,936 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"fct_subscription_changes": 1063765634> (evaluator.py:700)
2025-09-17 15:18:13,936 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"fct_subscription_changes": 1063765634> (evaluator.py:909)
2025-09-17 15:18:13,942 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-09-16 00:00:00, 2025-09-17 00:00:00) into sqlmesh__default.fct_subscription_changes__2699429937' (evaluator.py:939)
2025-09-17 15:18:13,942 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ DESCRIBE "sqlmesh__default"."fct_subscription_changes__2699429937" (base.py:2498)
2025-09-17 15:18:13,942 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Replacing view 'sqlmesh__default.fct_subscription_changes__2699429937' (evaluator.py:2341)
2025-09-17 15:18:13,942 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ SELECT CURRENT_CATALOG() (base.py:2498)
2025-09-17 15:18:13,943 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'trail_trekker' AND table_schema = 'sqlmesh__default') AND table_name IN ('fct_subscription_changes__2699429937') (base.py:2498)
2025-09-17 15:18:13,946 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 44c0b0f2a8f34b73b145686bb549ea0a */ CREATE OR REPLACE VIEW "sqlmesh__default"."fct_subscription_changes__2699429937" ("customer_id", "subscription_id", "plan_id", "subscription_start_date", "subscription_end_date", "status", "billing_cycle", "plan_name", "monthly_revenue", "plan_level", "max_hikes_per_month", "subscription_duration_days", "is_active", "total_subscription_value") AS SELECT "s"."customer_id" AS "customer_id", "s"."subscription_id" AS "subscription_id", "s"."plan_id" AS "plan_id", "s"."subscription_start_date" AS "subscription_start_date", "s"."subscription_end_date" AS "subscription_end_date", "s"."status" AS "status", "s"."billing_cycle" AS "billing_cycle", "p"."plan_name" AS "plan_name", "p"."price" AS "monthly_revenue", "p"."plan_level" AS "plan_level", "p"."max_hikes_per_month" AS "max_hikes_per_month", CASE WHEN "s"."subscription_end_date" = CAST('1900-01-01' AS DATE) THEN (CURRENT_DATE - "s"."subscription_start_date") ELSE ("s"."subscription_end_date" - "s"."subscription_start_date") END AS "subscription_duration_days", CASE WHEN "s"."status" = 'active' AND "s"."subscription_end_date" = CAST('1900-01-01' AS DATE) THEN TRUE ELSE FALSE END AS "is_active", CASE WHEN "s"."billing_cycle" = 'monthly' THEN "p"."price" WHEN "s"."billing_cycle" = 'yearly' THEN "p"."price" * 12 ELSE "p"."price" END AS "total_subscription_value" FROM "sqlmesh__default"."staging_subscriptions__3522423559" AS "s" LEFT JOIN "sqlmesh__default"."staging_plans__223612256" AS "p" ON "p"."plan_id" = "s"."plan_id" ORDER BY "s"."customer_id", "s"."subscription_start_date" DESC (base.py:2498)
2025-09-17 15:18:13,948 - MainThread - sqlmesh.core.scheduler - INFO - Execution failed for node EvaluateNode(snapshot_name='"fct_subscription_changes"', interval=(1757980800000, 1758067200000), batch_index=0) (scheduler.py:597)
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/utils/concurrency.py", line 234, in sequential_apply_to_dag
    fn(node)
    ~~^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/scheduler.py", line 533, in run_node
    audit_results = self.evaluate(
        snapshot=snapshot,
    ...<9 lines>...
        selected_models=selected_models,
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/scheduler.py", line 229, in evaluate
    wap_id = self.snapshot_evaluator.evaluate(
        snapshot,
    ...<9 lines>...
        **kwargs,
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/snapshot/evaluator.py", line 182, in evaluate
    result = self._evaluate_snapshot(
        start=start,
    ...<9 lines>...
        **kwargs,
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/snapshot/evaluator.py", line 796, in _evaluate_snapshot
    self._render_and_insert_snapshot(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        start=start,
        ^^^^^^^^^^^^
    ...<10 lines>...
        batch_index=batch_index,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/snapshot/evaluator.py", line 989, in _render_and_insert_snapshot
    apply(query_or_df, index)
    ~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/snapshot/evaluator.py", line 945, in apply
    evaluation_strategy.insert(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^
        table_name=target_table_name,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<11 lines>...
        render_kwargs=create_render_kwargs,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/snapshot/evaluator.py", line 2342, in insert
    self.adapter.create_view(
    ~~~~~~~~~~~~~~~~~~~~~~~~^
        table_name,
        ^^^^^^^^^^^
    ...<6 lines>...
        column_descriptions=model.column_descriptions,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/engine_adapter/shared.py", line 318, in internal_wrapper
    return func(*list_args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/engine_adapter/base.py", line 1317, in create_view
    self.execute(
    ~~~~~~~~~~~~^
        exp.Create(
        ^^^^^^^^^^^
    ...<6 lines>...
        quote_identifiers=self.QUOTE_IDENTIFIERS_IN_VIEWS,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/engine_adapter/base.py", line 2475, in execute
    self._execute(sql, track_rows_processed, **kwargs)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/engine_adapter/base.py", line 2507, in _execute
    self.cursor.execute(sql, **kwargs)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
duckdb.duckdb.BinderException: Binder Error: No function matches the given name and argument types '-(DATE, VARCHAR)'. You might need to add explicit type casts.
	Candidate functions:
	-(TINYINT) -> TINYINT
	-(TINYINT, TINYINT) -> TINYINT
	-(SMALLINT) -> SMALLINT
	-(SMALLINT, SMALLINT) -> SMALLINT
	-(INTEGER) -> INTEGER
	-(INTEGER, INTEGER) -> INTEGER
	-(BIGINT) -> BIGINT
	-(BIGINT, BIGINT) -> BIGINT
	-(HUGEINT) -> HUGEINT
	-(HUGEINT, HUGEINT) -> HUGEINT
	-(FLOAT) -> FLOAT
	-(FLOAT, FLOAT) -> FLOAT
	-(DOUBLE) -> DOUBLE
	-(DOUBLE, DOUBLE) -> DOUBLE
	-(DECIMAL) -> DECIMAL
	-(DECIMAL, DECIMAL) -> DECIMAL
	-(UTINYINT) -> UTINYINT
	-(UTINYINT, UTINYINT) -> UTINYINT
	-(USMALLINT) -> USMALLINT
	-(USMALLINT, USMALLINT) -> USMALLINT
	-(UINTEGER) -> UINTEGER
	-(UINTEGER, UINTEGER) -> UINTEGER
	-(UBIGINT) -> UBIGINT
	-(UBIGINT, UBIGINT) -> UBIGINT
	-(UHUGEINT) -> UHUGEINT
	-(UHUGEINT, UHUGEINT) -> UHUGEINT
	-(DATE, DATE) -> BIGINT
	-(DATE, INTEGER) -> DATE
	-(TIMESTAMP, TIMESTAMP) -> INTERVAL
	-(INTERVAL, INTERVAL) -> INTERVAL
	-(DATE, INTERVAL) -> TIMESTAMP
	-(TIME, INTERVAL) -> TIME
	-(TIMESTAMP, INTERVAL) -> TIMESTAMP
	-(TIME WITH TIME ZONE, INTERVAL) -> TIME WITH TIME ZONE
	-(INTERVAL) -> INTERVAL
	-(TIMESTAMP WITH TIME ZONE, INTERVAL) -> TIMESTAMP WITH TIME ZONE
	-(TIMESTAMP WITH TIME ZONE, TIMESTAMP WITH TIME ZONE) -> INTERVAL


LINE 1: ..._end_date" = CAST('1900-01-01' AS DATE) THEN (CURRENT_DATE - "s"."subscription_start_date") ELSE ("s"."subscription_en...
                                                                      ^

The above exception was the direct cause of the following exception:

sqlmesh.utils.concurrency.NodeExecutionFailedError: Execution failed for node EvaluateNode(snapshot_name='"fct_subscription_changes"', interval=(1757980800000, 1758067200000), batch_index=0)
2025-09-17 15:18:13,956 - MainThread - sqlmesh.core.context - INFO - Plan application failed. (context.py:1735)
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/context.py", line 1727, in apply
    self._apply(plan, circuit_breaker)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/context.py", line 2519, in _apply
    self._scheduler.create_plan_evaluator(self).evaluate(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        plan.to_evaluatable(), circuit_breaker=circuit_breaker
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/plan/evaluator.py", line 105, in evaluate
    self._evaluate_stages(plan_stages, plan)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/plan/evaluator.py", line 125, in _evaluate_stages
    handler(stage, plan)
    ~~~~~~~^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlmesh/core/plan/evaluator.py", line 263, in visit_backfill_stage
    raise PlanError("Plan application failed.")
sqlmesh.utils.errors.PlanError: Plan application failed.
2025-09-17 15:18:13,964 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
